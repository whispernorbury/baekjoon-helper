#!/bin/bash
LANG=$1
if [ -z "$LANG" ]; then
    echo "Usage: bash run [cpp|py|js]"
    exit 1
fi

case "$LANG" in
    cpp)
        IMAGE_NAME=myrunner-cpp
        DOCKER_CONTENT="
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y g++ && apt-get clean
WORKDIR /app
COPY . /app
"
        CMD="g++ cpp.cpp -o cpp.out && ./cpp.out"
        ;;
    py)
        IMAGE_NAME=myrunner-py
        DOCKER_CONTENT="
FROM python:3.12-alpine
WORKDIR /app
COPY . /app
"
        CMD="python3 py.py"
        ;;
    js)
        IMAGE_NAME=myrunner-js
        # Dockerfile content for Node.js
        DOCKER_CONTENT="
FROM node:21-alpine
WORKDIR /app
COPY . /app
"
        CMD="node js.js"
        ;;
    *)
        echo "Unknown language: $LANG"
        exit 1
        ;;
esac

TMP_DOCKERFILE="/tmp/Dockerfile.$LANG"
echo "$DOCKER_CONTENT" > "$TMP_DOCKERFILE"

HOST_PWD=$(pwd -W 2>/dev/null || pwd)

docker build -t "$IMAGE_NAME" -f "$TMP_DOCKERFILE" . >/dev/null
docker run -i --rm "$IMAGE_NAME" sh -c "$CMD"
rm "$TMP_DOCKERFILE"